events {                                            # obavezno: koliko konekcija worker može držati otvoreno
    worker_connections 1024;                        # 1024 je ok za lokalni demo
}

http {
    include       mime.types;                   	# mapira ekstenzije (.html, .png, .css...) u MIME tip
    default_type  application/octet-stream;         # zadnji fallback MIME tip ako ekstenzija nije u mapiranju
    sendfile      on;                               # datoteke šalje kernel (brže nego preko user-space bufferiranja)
    keepalive_timeout 65;                           # koliko sekundi držimo vezu otvorenom za isti klijent

    server {                                        # glavni virtualni host: HTTPS + HTTP/2
        listen 443 ssl;                             # 443 = standardni HTTPS port; ssl znači koristi TLS
        http2 on;                                   # ovdje uključujemo HTTP/2 (multiplexing na jednoj konekciji)
                                                    # razlika: "ssl" uključuje šifriranje, "http2 on" uključuje novi protokol preko tog TLS-a
        server_name localhost;                      # ovo ime se koristi za SNI (Server Name Indication) i matching hosta
        ssl_certificate     ssl.crt;                # relativno na nginx instalacijski folder (conf/ssl.crt u conf diru)
        ssl_certificate_key ssl.key;                # relativno na nginx instalacijski folder (conf/ssl.key)

        root   html;                                # dokument-root za ovaj virtualni host
        index  index.html index.htm;                # redoslijed datoteka koje se nude kad tražiš direktorij

        error_page 404 /errors/404.html;            # 404 i 403 stranice mogu biti unutar root foldera (npr. html/errors/404.html)
        error_page 403 /errors/403.html;            # ali također može biti unutar trenutnog location-a za specifično rutni error
                                                    # npr. html/contacts/errors/404.html ako ga nema, zove se onaj s više razine

        location / {                                # pravila za sve URL-ove
            try_files $uri $uri/ =404;              # 1) $uri -> pokušaj točan fajl (npr. /style.css)
                                                    # 2) $uri/ -> ako nema fajla, pokušaj direktorij (npr. /blog/ kao folder)
                                                    # 3) =404 -> ako nijedno ne postoji, odmah vrati HTTP 404 (nema daljnjeg traženja)
                                                    # $uri je tražena putanja, $uri/ je ista putanja ali tretirana kao folder
        }
    }

    server {                                        # pomoćni virtualni host: preusmjerava HTTP na HTTPS
        listen      80;                             # obični HTTP port
        server_name localhost;                      # isto ime, ali bez šifriranja
        return 301 https://$host$request_uri;       # 301 = trajno; $host i $request_uri čuvaju cijeli URL
                                                    # rezultat: sve HTTP zahtjeve šaljemo na HTTPS verziju
    }
}